# 逆向投资策略分析工具

## 🎯 策略概述

逆向投资策略是一种在大盘上涨时寻找被错杀个股的投资方法。该策略基于市场情绪过度反应的理论，认为在大盘上涨的背景下，某些个股的大幅下跌可能是过度悲观情绪导致的，存在反弹机会。

## 📊 筛选条件

### 核心筛选逻辑
1. **大盘表现要求**：对应指数（板块指数）涨幅 ≥ 2%
2. **个股表现要求**：个股当日跌幅 ≥ 6%
3. **历史表现要求**：个股近20个交易日涨幅 ≤ 20%

### 板块指数对应关系
- **上证股票** (600/601/603开头) → 上证指数 (000001.SH)
- **深证股票** (000开头) → 深证成指 (399001.SZ)  
- **中小板股票** (002开头) → 深证成指 (399001.SZ)
- **创业板股票** (300开头) → 创业板指 (399006.SZ)
- **科创板股票** (688开头) → 科创50 (000688.SH)

## 🚀 使用方法

### 方法1：使用Shell脚本
```bash
# 直接运行
./scripts/shell/run_contrarian_strategy.sh
```

### 方法2：直接运行Python脚本
```bash
cd /Users/nxm/PycharmProjects/dataDig
python scripts/strategy/contrarian_strategy_analysis.py
```

## 📈 分析维度

### 表现分析周期
- **短期表现**：未来5个交易日的涨跌情况
- **中期表现**：未来10个交易日的涨跌情况

### 分析指标
- **平均收益率**：所有筛选股票的平均收益率
- **中位数收益率**：更稳健的中位数收益率
- **胜率**：获得正收益的股票占比
- **最大/最小收益率**：表现最好和最差的股票收益率
- **板块分布**：按板块统计筛选结果

## 📊 输出示例

```
========== 逆向投资策略分析 ==========
策略描述: 寻找大盘上涨时被错杀的个股
筛选日期: 20241201
==================================================

✅ 筛选结果: 找到 12 只符合条件的股票

========== 筛选股票详情 ==========
ts_code     name      board  pct_chg  corresponding_index  index_pct_chg  historical_performance
000001.SZ   平安银行    sz     -7.2     399001.SZ           2.8            15.3
300001.SZ   特锐德     cyb    -8.5     399006.SZ           3.1            8.9
600036.SH   招商银行    sh     -6.8     000001.SH           2.3            12.7

========== 板块分布统计 ==========
board  股票数量  平均个股跌幅%  平均指数涨幅%
cyb       4        -7.2         3.0
sh        5        -6.9         2.3
sz        3        -7.8         2.8

========== 5个交易日后表现分析 ==========
📊 分析期间: 20241201 -> 5个交易日后
📈 分析股票数: 12只
💰 平均收益率: 3.45%
📊 中位数收益率: 2.80%
🎯 胜率: 75.00%
🔥 最大收益率: 12.30%
❄️ 最小收益率: -2.10%
📈 上涨股票: 9只
📉 下跌股票: 3只

🏆 表现最好的3只股票(5个交易日后):
  1. 特锐德(300001.SZ): 12.30%
  2. 平安银行(000001.SZ): 8.90%
  3. 招商银行(600036.SH): 6.70%

========== 策略效果对比分析 ==========
📊 逆向投资策略效果总结:
   5日平均收益率: 3.45%  |  10日平均收益率: 4.20%
   5日胜率: 75.00%       |  10日胜率: 66.67%
   5日最大收益: 12.30%   |  10日最大收益: 15.80%

🎯 策略评价:
✅ 逆向策略整体有效：短期和中期都获得正收益
✅ 胜率表现良好：超过60%的股票获得正收益
```

## 📁 输出文件

### 自动生成的分析文件
1. **详细股票表现**：`股票筛选表现分析_[日期]_[时间].csv`
   - 包含每只股票的详细表现数据
   - 筛选价格、目标价格、收益率等

2. **统计摘要报告**：`股票筛选统计摘要_[日期]_[时间].txt`
   - 策略整体表现摘要
   - 各项统计指标汇总

### 文件保存位置
```
/Users/nxm/PycharmProjects/dataDig/results/
```

## ⚙️ 参数自定义

### 修改筛选条件
可以在脚本中调整以下参数：

```python
contrarian_condition = ContrarianCondition(
    screener_service=screener,
    screening_date=screening_date,
    min_index_rise=2.0,      # 指数最小涨幅，默认2%
    max_stock_fall=-6.0,     # 个股最大跌幅，默认-6%（即跌6%以上）
    max_historical_rise=20.0, # 历史最大涨幅，默认20%
    historical_days=20       # 历史天数，默认20天
)
```

### 修改分析周期
```python
# 分析5天后表现
performance_5d = screener.analyze_performance(
    screened_stocks=screened_stocks,
    screening_date=screening_date,
    analysis_days=5,  # 可修改为其他天数
    condition_description=condition_desc
)
```

## 🎯 策略适用场景

### 最佳使用时机
1. **大盘处于上涨趋势**：指数有明确的上涨动力
2. **市场情绪分化明显**：部分股票明显跑输大盘
3. **系统性风险较低**：避免在重大利空消息期间使用

### 风险提示
1. **个股下跌可能有基本面原因**：需要结合财务数据分析
2. **市场情绪可能持续悲观**：短期可能继续下跌
3. **行业轮动影响**：某些行业可能正在失去市场青睐

## 📊 策略优化建议

### 进一步筛选条件
1. **财务健康度**：添加负债率、现金流等财务指标
2. **技术形态**：结合技术分析指标（RSI、布林带等）
3. **消息面筛选**：排除有重大利空消息的股票
4. **流动性要求**：确保有足够的成交量

### 风险控制
1. **仓位控制**：单只股票仓位不超过总资金的5%
2. **止损设置**：设置合理的止损点，如-10%
3. **分批建仓**：可以分2-3次建仓，降低时机风险
4. **定期复盃**：定期检查持仓股票的基本面变化

## 🔧 技术架构

### 核心组件
- **StockScreenerService**：股票筛选服务
- **ContrarianCondition**：逆向投资筛选条件
- **PerformanceAnalysisResult**：表现分析结果

### 数据依赖
- **股票基础信息**：stock_basic表
- **日线价格数据**：daily_price表
- **每日基本面数据**：daily_basic表
- **指数日线数据**：index_daily表

### 日志系统
- **详细流程日志**：记录筛选和分析的每个步骤
- **错误处理**：完整的异常捕获和错误信息记录
- **性能监控**：记录各阶段的执行时间和数据量
